#! /bin/bash
CONFIG=$1
source $CONFIG

echo -e "\e[36m Scanning classifiers and getting optimal parameters\e[39m"

rm -f errors/error_train
rm -f logs/log_train

echo "python /project/cmcwhite/github/run_TPOT/train_test_model2.py --training_infile feature_matrix/${EXP_PREFIX}_feature_matrix.labeled1 --exported_pipeline training/tpot_${EXP_PREFIX}.py --id_cols 0 --output_basename training/tpot_${EXP_PREFIX}"  > records/record_train_COMMANDS.sh

if [ $GEN_COMMANDS_ONLY != "T" ];then

  bash records/record_train_COMMANDS.sh > logs/log_train 2> errors/error_train

  # Check for exit code of command
  status=$?

  if [ ! $status -eq 0 ]; then
    echo -e "\e[91mError while training model\e[39m"
    echo -e "\e[91mSee stdout at log/log_train\e[39m"
    echo -e "\e[91mSee errors at errors/error_train\e[39m"
    exit 1
  else
    echo -e "\e[35mModel trained without errors (tpot_${EXP_PREFIX}_fitted_model.p)\e[39m"

  fi
fi  
 
